{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": "container",
    "height": 400,
    "title": "Mental Health Status by Occupation",
    "data": {
        "url": "https://raw.githubusercontent.com/Bot1234-dotcom/Data-Visualisation-2/refs/heads/main/data/mental_health_questionnaire.csv"
    },
    "transform": [
        {
            "fold": ["Growing_Stress", "Changes_Habits", "Coping_Struggles", "Work_Interest", "Social_Weakness"],
            "as": ["Question", "Response"]
        },
        {
            "aggregate": [{"op": "count", "as": "count"}],
            "groupby": ["Occupation", "Question", "Response"]
        },
        {
            "joinaggregate": [{"op": "sum", "field": "count", "as": "total"}],
            "groupby": ["Occupation", "Question"]
        },
        {
            "calculate": "datum.count / datum.total",
            "as": "percent"
        },
        {
            "calculate": "datum.Question == 'Growing_Stress' ? 'Increasing stress level' : datum.Question == 'Changes_Habits' ? 'Habits changed' : datum.Question == 'Coping_Struggles' ? 'Struggling to cope' : datum.Question == 'Work_Interest' ? 'Interest in work' : 'Difficulty in social interactions'",
            "as": "Question_Label"
        }
    ],
    "mark": "bar",
    "encoding": {
        "x": {"field": "Occupation", "type": "nominal", "axis": {"labelAngle": 0}},
        "xOffset": {"field": "Question", "type": "nominal"},
        "y": {
            "field": "percent",
            "type": "quantitative",
            "stack": "normalize",
            "title": "Proportion"
        },
        "color": {
            "field": "Response",
            "type": "nominal",
            "scale": {
                "domain": ["No", "Maybe", "Yes"],
                "range": ["#1b9e77", "#d95f02", "#7570b3"]
            }
        },
        "tooltip": [
            {"field": "Occupation"},
            {"field": "Question_Label", "title": "Indicator"},
            {"field": "Response"},
            {"field": "percent", "format": ".1%", "title": "Proportion"}
        ]
    }
}